---
layout: post
title: "ragä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰"
date: 2026-02-03
last_modified_at: 2026-02-03
categories: [æŠ€æœ¯çºµæ¨ª]
tags: [rag]
cover: https://qiniu.zhuyucun.cn/uploads/1764853276621_kn1jl7.jpg
excerpt: >
  embeddingå‘é‡åŒ–ã€‚
---

### æ¦‚è¿°
embeddingå‘é‡åŒ–æ˜¯å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºçš„è¿‡ç¨‹ï¼Œåœ¨ragçŸ¥è¯†åº“ä¸­æœ€é‡è¦çš„æ˜¯è¦åŒ¹é…ç”¨æˆ·çš„è¾“å…¥å’ŒçŸ¥è¯†åº“çš„å†…å®¹ï¼Œæ ¹æ®ç”¨æˆ·çš„é—®é¢˜æ£€ç´¢å‡ºä¸é—®é¢˜ç›¸å…³çš„æ–‡æ¡£ã€‚è®¡ç®—æœºæ— æ³•ç›´æ¥ç†è§£æ–‡æœ¬ï¼Œå› æ­¤è¦å°†çŸ¥è¯†åº“åˆ‡åˆ†å¹¶è½¬ä¸ºå‘é‡è¡¨ç¤ºï¼Œç”¨æˆ·çš„è¾“å…¥ä¹Ÿéœ€è¦è½¬ä¸ºå‘é‡è¡¨ç¤ºï¼Œç„¶åè®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä»è€ŒåŒ¹é…å‡ºä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„æ–‡æ¡£ã€‚  


### ç®€å•ä½¿ç”¨
ä¸åŒçš„æ¨¡å‹æ”¯æŒä¸åŒçš„å‘é‡åŒ–ç»´åº¦ï¼Œä¾‹å¦‚text-embedding-v4æ”¯æŒ64~2048ç»´

``` py
from openai import OpenAI
from config.settings import settings

client = OpenAI(
    api_key=settings.api_key,
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

result = client.embeddings.create(input="ä½ å¥½", model="text-embedding-v4")

print( result)
æ‰“å°å‡ºä¸€ä¸ªå‘é‡åŒ–åçš„ç»“æœ
""" 
CreateEmbeddingResponse(data=[Embedding(embedding=[0.00775288138538599, -0.06167956814169884, 0.07296541333198547, 0.06845107674598694, .... ... 0.03675258532166481, 0.04067809507250786, 0.0319683700799942], index=0, object='embedding')], model='text-embedding-v4', object='list', usage=Usage(prompt_tokens=2, total_tokens=2), id='bc2dea3a-90b7-9de9-ae49-df270ca791c4')
"""
```

### å‘é‡é—´çš„ç›¸ä¼¼åº¦è®¡ç®—
1ã€Cosineç›¸ä¼¼åº¦ï¼š  
å®šä¹‰ï¼šä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦æ˜¯å®ƒä»¬å¤¹è§’çš„ä½™å¼¦å€¼ï¼ŒèŒƒå›´åœ¨[-1, 1]ä¹‹é—´ã€‚å€¼è¶Šæ¥è¿‘1è¡¨ç¤ºè¶Šç›¸ä¼¼ï¼Œå€¼è¶Šæ¥è¿‘-1è¡¨ç¤ºè¶Šä¸ç›¸ä¼¼ã€‚  
2ã€æ¬§æ°è·ç¦»ï¼š  
å®šä¹‰ï¼šä¸¤ä¸ªå‘é‡ä¹‹é—´çš„æ¬§æ°è·ç¦»æ˜¯å®ƒä»¬åœ¨ç©ºé—´ä¸­çš„å®é™…è·ç¦»ï¼Œå³ç‚¹åˆ°ç‚¹çš„è·ç¦»ã€‚  
3ã€ç‚¹ç§¯ï¼š  
å®šä¹‰ï¼šä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ç‚¹ç§¯æ˜¯å®ƒä»¬å¯¹åº”å…ƒç´ çš„ä¹˜ç§¯ä¹‹å’Œã€‚  

#### Cosineç›¸ä¼¼åº¦
å…¬å¼ï¼š
consine_similarity = A Â· B / (||A|| * ||B||)
å…¶ä¸­ï¼ŒAå’ŒBæ˜¯ä¸¤ä¸ªå‘é‡ï¼Œ||A||å’Œ||B||åˆ†åˆ«æ˜¯Aå’ŒBçš„èŒƒæ•°ï¼ˆå³å‘é‡çš„é•¿åº¦ï¼‰ã€‚  

``` py
import numpy as np

def cosine_similarity(A, B):
    """
    è®¡ç®—ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦
    :param A: å‘é‡A
    :param B: å‘é‡B
    :return: ä½™å¼¦ç›¸ä¼¼åº¦
    """
    dot_product = np.dot(A, B)
    norm_A = np.linalg.norm(A)
    norm_B = np.linalg.norm(B)
    return dot_product / (norm_A * norm_B)
```

#### æ¬§æ°è·ç¦»
d(A,B)=âˆ¥Aâˆ’Bâˆ¥
å…¶ä¸­ï¼ŒAå’ŒBæ˜¯ä¸¤ä¸ªå‘é‡ï¼Œ||Aâˆ’B||æ˜¯Aå’ŒBä¹‹é—´çš„æ¬§æ°è·ç¦»ã€‚

```py
import numpy as np

def euclidean_distance(A, B):
    """
    è®¡ç®—ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„æ¬§æ°è·ç¦»
    :param A: å‘é‡A
    :param B: å‘é‡B
    :return: æ¬§æ°è·ç¦»
    """
    return np.linalg.norm(A - B)
```

### å‘é‡æ•°æ®åº“
å‘é‡æ•°æ®åº“æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œæ£€ç´¢å‘é‡è¡¨ç¤ºçš„æ•°æ®åº“ã€‚å®ƒå¯ä»¥æ ¹æ®å‘é‡çš„ç›¸ä¼¼åº¦å¿«é€ŸåŒ¹é…å‡ºä¸æŸ¥è¯¢å‘é‡ç›¸å…³çš„å‘é‡ã€‚
å‘é‡æ•°æ®åº“æœ‰ï¼š
#### Chroma
- [Chromaå®˜æ–¹ç½‘ç«™](https://www.trychroma.com/)
- [pythonä¸­çš„chromaå‘é‡æ•°æ®åº“åŸºç¡€ä½¿ç”¨æ–¹æ³•](chromaå‘é‡æ•°æ®åº“ä½¿ç”¨.html)  

#### Pinecone
- [Pineconeå®˜æ–¹ç½‘ç«™](https://www.pinecone.io/)

#### milvus
- [Milvuså®˜æ–¹ç½‘ç«™](https://milvus.io/)

#### faiss
- [faisså®˜æ–¹ç½‘ç«™](https://faiss.ai/)

### ğŸ’» ä»£ç å®ç°
æ¡ˆä¾‹ä»£ç ä½¿ç”¨äº†langchainæ¥å®ç°æœ€åŸºç¡€çš„ragæµç¨‹ï¼ŒåŒ…æ‹¬ï¼š
- æ–‡æ¡£åŠ è½½
- æ–‡æ¡£åˆ‡åˆ†æˆæ–‡æ¡£å—
- æ–‡æ¡£å—å‘é‡åŒ–å¹¶å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“Chromaé‡Œ  
- ç”¨æˆ·è¾“å…¥å‘é‡åŒ–
- ä»å‘é‡æ•°æ®åº“Chromaé‡Œæ£€ç´¢å‡ºä¸ç”¨æˆ·è¾“å…¥æœ€ç›¸ä¼¼çš„æ–‡æ¡£å—
- æ•´åˆæ–‡æ¡£å—å’Œç”¨æˆ·çš„é—®é¢˜æˆæ–°çš„prompt
- ä½¿ç”¨æ–°çš„promptè°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå›ç­”  

[ragåŸºç¡€å®ç°ä»£ç æ¡ˆä¾‹](https://github.com/ander1716/LLM_code_snippet/blob/main/rag/rag-simple-example.py)
