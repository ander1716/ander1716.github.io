---
layout: default
---

<!-- Post Layout -->
<article class="post-layout">
  <div class="wrapper">
    <div class="post-layout-grid">
      <!-- Table of Contents (Left Sidebar) -->
      <aside class="post-toc">
        <div class="toc-wrapper">
          <h3 class="toc-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
            目录
          </h3>
          <nav id="toc-nav" class="toc-nav">
            <!-- 目录将通过JavaScript动态生成 -->
          </nav>
        </div>
      </aside>

      <div class="post-container">
      <!-- Post Header -->
      <header class="post-header">
        <!-- Post Title -->
        <h1 class="post-title">{{ page.title }}</h1>

        <!-- Post Meta (Categories & Tags) -->
        <div class="post-meta">
          {% if page.categories.size > 0 %}
          <a href="{{ '/categories' | relative_url }}" class="post-category">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px;">
              <path d="M4 7V4h16v3"></path>
              <path d="M9 20h6"></path>
              <path d="M12 4v16"></path>
            </svg>
            {{ page.categories | first }}
          </a>
          {% endif %}

          {% if page.tags.size > 0 %}
            {% for tag in page.tags %}
            <a href="{{ '/tags' | relative_url }}#{{ tag | slugify }}" class="post-tag">
              #{{ tag }}
            </a>
            {% endfor %}
          {% endif %}
        </div>
      </header>

      <!-- Post Content -->
      <div class="post-content">
        {{ content }}
      </div>

      <!-- Post Dates Section -->
      <div class="post-dates-section">
        <div class="post-dates-wrapper">
          <time class="post-date" datetime="{{ page.date | date: '%Y-%m-%d' }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            发布于 {{ page.date | date: "%Y年%m月%d日" }}
          </time>
          {% if page.last_modified_at %}
          <time class="post-modified" datetime="{{ page.last_modified_at | date: '%Y-%m-%d' }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            更新于 {{ page.last_modified_at | date: "%Y-%m-%d" }}
          </time>
          {% endif %}
        </div>
      </div>

      <!-- Post Footer -->
      <footer class="post-footer">
        <!-- Post Navigation -->
        <div class="post-navigation">
          {% if page.previous %}
          <a href="{{ page.previous.url | relative_url }}" class="nav-link nav-prev">
            <span class="nav-direction">← 上一篇</span>
            <span class="nav-title">{{ page.previous.title }}</span>
          </a>
          {% else %}
          <div class="nav-link nav-prev disabled">
            <span class="nav-direction">← 上一篇</span>
            <span class="nav-title">没有更早的文章了</span>
          </div>
          {% endif %}

          {% if page.next %}
          <a href="{{ page.next.url | relative_url }}" class="nav-link nav-next">
            <span class="nav-direction">下一篇 →</span>
            <span class="nav-title">{{ page.next.title }}</span>
          </a>
          {% else %}
          <div class="nav-link nav-next disabled">
            <span class="nav-direction">下一篇 →</span>
            <span class="nav-title">没有更多文章了</span>
          </div>
          {% endif %}
        </div>

        <!-- Related Posts -->
        {% assign related_posts = site.posts | where_exp:"post", "post.url != page.url" | limit: 4 %}
        {% assign has_related = false %}
        {% for post in related_posts %}
          {% for cat in post.categories %}
            {% if page.categories contains cat %}
              {% assign has_related = true %}
              {% break %}
            {% endif %}
          {% endfor %}
          {% if has_related %}{% break %}{% endif %}
        {% endfor %}
      </footer>
      </div>
    </div>
  </div>
</article>

<link rel="stylesheet" href="{{ '/assets/css/post.css' | relative_url }}" />

<!-- Table of Contents Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tocNav = document.getElementById('toc-nav');
  const postContent = document.querySelector('.post-content');
  const tocWrapper = document.querySelector('.post-toc');
  
  if (!tocNav || !postContent) return;
  
  // 获取所有标题（h2, h3, h4）
  const headings = postContent.querySelectorAll('h1, h2, h3, h4');
  
  if (headings.length === 0) {
    // 如果没有标题，隐藏目录
    tocWrapper.style.display = 'none';
    return;
  }
  
  // 为每个标题添加ID（如果没有的话）
  headings.forEach((heading, index) => {
    if (!heading.id) {
      heading.id = `heading-${index}`;
    }
  });
  
  // 生成目录HTML
  let tocHTML = '<ul class="toc-list">';
  let currentLevel = 0;
  
  headings.forEach((heading, index) => {
    const level = parseInt(heading.tagName.substring(1));
    const text = heading.textContent;
    const id = heading.id;
    
    // 处理层级
    if (level > currentLevel) {
      for (let i = currentLevel; i < level; i++) {
        tocHTML += '<ul class="toc-list">';
      }
    } else if (level < currentLevel) {
      for (let i = level; i < currentLevel; i++) {
        tocHTML += '</ul>';
      }
    }
    
    tocHTML += `<li class="toc-item toc-level-${level}">
                  <a href="#${id}" class="toc-link" data-target="${id}">${text}</a>
                </li>`;
    
    currentLevel = level;
  });
  
  // 关闭所有未闭合的ul标签
  for (let i = 1; i < currentLevel; i++) {
    tocHTML += '</ul>';
  }
  tocHTML += '</ul>';
  
  tocNav.innerHTML = tocHTML;
  
  // 平滑滚动
  const tocLinks = tocNav.querySelectorAll('.toc-link');
  tocLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('data-target');
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        const offset = 80; // 顶部偏移量
        const elementPosition = targetElement.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - offset;
        
        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });
        
        // 更新活动状态
        tocLinks.forEach(l => l.classList.remove('active'));
        this.classList.add('active');
      }
    });
  });
  
  // 滚动时高亮当前章节
  let isScrolling = false;
  window.addEventListener('scroll', function() {
    if (isScrolling) return;
    
    isScrolling = true;
    setTimeout(function() {
      let current = '';
      
      headings.forEach(heading => {
        const sectionTop = heading.offsetTop - 100;
        if (window.pageYOffset >= sectionTop) {
          current = heading.id;
        }
      });
      
      tocLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('data-target') === current) {
          link.classList.add('active');
        }
      });
      
      isScrolling = false;
    }, 100);
  });
});

// 图片点击放大功能
function initImageZoom() {
  const postContent = document.querySelector('.post-content');
  if (!postContent) return;
  
  const images = postContent.querySelectorAll('img');
  if (images.length === 0) return;
  
  // 创建模态框
  const modal = document.createElement('div');
  modal.className = 'image-modal';
  modal.innerHTML = `
    <div class="image-modal-content">
      <span class="image-modal-close">&times;</span>
      <img class="image-modal-img" src="" alt="">
      <div class="image-modal-caption"></div>
    </div>
  `;
  document.body.appendChild(modal);
  
  const modalImg = modal.querySelector('.image-modal-img');
  const modalCaption = modal.querySelector('.image-modal-caption');
  const closeBtn = modal.querySelector('.image-modal-close');
  
  // 点击图片打开模态框
  images.forEach(img => {
    img.style.cursor = 'zoom-in';
    img.addEventListener('click', function() {
      modal.style.display = 'flex';
      modalImg.src = this.src;
      modalImg.alt = this.alt;
      
      // 获取图片标题（如果有）
      const caption = this.nextElementSibling;
      if (caption && caption.tagName === 'EM' && caption.textContent.includes('图')) {
        modalCaption.textContent = caption.textContent;
      } else {
        modalCaption.textContent = this.alt || '';
      }
      
      document.body.style.overflow = 'hidden';
    });
  });
  
  // 关闭模态框
  closeBtn.addEventListener('click', function() {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
  });
  
  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  });
  
  // ESC键关闭
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && modal.style.display === 'flex') {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  });
}

// 初始化图片放大功能
document.addEventListener('DOMContentLoaded', initImageZoom);
</script>
