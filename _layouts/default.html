<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% if page.title %}{{ page.title }} - {% endif %}z-blog</title>
    <link rel="stylesheet" href="{{ '/assets/css/home.css' | relative_url }}" />
    <link rel="icon" type="image/png" href="https://qiniu.zhuyucun.cn/uploads/1764903456608_pfm3mt.jpg" />
    <style>
      /* æœç´¢æŒ‰é’®æ ·å¼ */
      .search-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        color: var(--text-gray);
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
      }

      .search-btn:hover {
        background-color: rgba(47, 191, 160, 0.1);
        color: var(--primary-color);
        transform: scale(1.1);
      }
    </style>
  </head>
  <body>
    <!-- æœç´¢æµ®çª— -->
    <div id="search-overlay" class="search-overlay">
      <div class="search-overlay-bg"></div>
      <div class="search-wrapper-centered">
        <button class="close-search-btn" aria-label="Close search">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        <div id="global-search-box" class="search-box-container"></div>
        <div id="global-hits-container" class="search-hits-container"></div>
      </div>
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css" />
    
    <style>
      /* æœç´¢æµ®çª—æ ·å¼ */
      .search-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: none; /* é»˜è®¤éšè— */
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .search-overlay.active {
        display: flex;
        opacity: 1;
      }

      .search-overlay-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
      }

      .search-wrapper-centered {
        position: relative;
        width: 100%;
        max-width: 700px;
        margin: 80px auto 0;
        padding: 0 20px;
        z-index: 10000;
        transform: translateY(-20px);
        transition: transform 0.3s ease;
      }

      .search-overlay.active .search-wrapper-centered {
        transform: translateY(0);
      }

      .close-search-btn {
        position: absolute;
        top: -40px;
        right: 20px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 5px;
        opacity: 0.8;
        transition: opacity 0.2s;
      }

      .close-search-btn:hover {
        opacity: 1;
      }

      /* æœç´¢æ¡†æ ·å¼é‡å†™ */
      .search-box-container .ais-SearchBox-form {
        background: white;
        border-radius: 8px 8px 0 0;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        height: 50px;
      }

      .search-box-container .ais-SearchBox-input {
        border: none;
        font-size: 16px;
        padding-left: 45px;
        border-radius: 8px;
      }

      .search-box-container .ais-SearchBox-submit {
        left: 15px;
        width: 20px;
      }

      .search-box-container .ais-SearchBox-reset {
        right: 15px;
      }

      /* è¦†ç›– Algolia InstantSearch é»˜è®¤æ ·å¼ */
      .ais-Hits-item,
      .ais-InfiniteHits-item {
        padding: 0 !important;
        border-bottom: none !important;
        line-height: normal !important;
        box-shadow: none !important;
        margin: 0 !important;
      }

      /* ç»“æœåˆ—è¡¨æ ·å¼ */
      .search-hits-container {
        margin-top: 1px;
        background: white;
        border-radius: 0 0 10px 10px;
        max-height: calc(100vh - 180px);
        overflow-y: auto;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        display: none; /* æœ‰ç»“æœæ—¶æ˜¾ç¤º */
        padding: 8px 0;
      }

      .global-search-item {
        padding: 3px 24px;
        border-bottom: 1px solid #f0f0f0;
        transition: all 0.15s ease;
        display: block;
        text-decoration: none;
        position: relative;
        flex: 1;
        color: #000 !important;
      }

      .global-search-item:hover {
        background: #eff0f3;
      }

      .global-search-item:hover::before {
        width: 4px;
      }

      .global-search-item:last-child {
        border-bottom: none;
      }

      .hit-title {
        font-size: 16px;
        font-weight: 500;
        color: #1a0dab;
        margin-bottom: 6px;
        display: block;
        transition: color 0.2s;
        line-height: 1.4;
      }

      .global-search-item:hover .hit-title {
        color: #1558d6;
        text-decoration: underline;
      }

      .global-search-item:visited .hit-title {
        color: rgb(58, 58, 58);
      }

      .hit-title mark {
        background: none;
        color: inherit;
        padding: 0;
        font-weight: 700;
      }

      .hit-content {
        font-size: 14px;
        color: #545454;
        line-height: 1.6;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .hit-content mark {
        background: none;
        color: inherit;
        font-weight: 600;
      }

      .hit-meta {
        font-size: 12px;
        color: #70757a;
        margin-top: 6px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      
      .hit-meta::before {
        content: '';
        display: inline-block;
        width: 14px;
        height: 14px;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%2370757a' stroke-width='2'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cpolyline points='12 6 12 12 16 14'/%3E%3C/svg%3E") center/contain no-repeat;
      }

      .no-results {
        padding: 40px;
        text-align: center;
        color: #70757a;
        font-size: 14px;
      }
      
      .no-results::before {
        content: 'ğŸ”';
        display: block;
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.3;
      }
    </style>

    <!-- Header -->
    <header class="site-header">
      <div class="wrapper header-inner">
        <!-- Logo -->
        <a href="{{ '/' | relative_url }}" class="site-title">
          <img src="https://qiniu.zhuyucun.cn/uploads/1764903456608_pfm3mt.jpg" alt="logo" class="logo-circle">
          <span class="site-title-text">z-blog</span>
        </a>
        
        <!-- Desktop Navigation -->
        <nav class="site-nav desktop-nav">
          {% for item in site.data.navigation %} {% if item.sublinks %}
          <!-- Dropdown menu for categories -->
          <div class="nav-dropdown">
            <button type="button" class="nav-dropdown-toggle">
              {{ item.name }}
            </button>
            <div class="nav-dropdown-menu">
              {% for sublink in item.sublinks %}
              <a href="{{ sublink.url | relative_url }}">{{ sublink.name }}</a>
              {% endfor %}
            </div>
          </div>
          {% else %}
          <!-- Regular navigation link -->
          <a href="{{ item.url | relative_url }}">{{ item.name }}</a>
          {% endif %} {% endfor %}
          
          <!-- Search Button -->
          <button type="button" class="search-btn" aria-label="Search">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </button>
        </nav>

        <!-- Right Side Actions (Mobile Only) -->
        <div class="header-actions">
          <!-- Mobile Menu Toggle -->
          <button type="button" class="mobile-menu-toggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
      </div>
      
      <!-- Mobile Navigation -->
      <nav class="site-nav mobile-nav">
        {% for item in site.data.navigation %} {% if item.sublinks %}
        <div class="nav-dropdown mobile-dropdown">
          <button type="button" class="nav-dropdown-toggle mobile-dropdown-toggle">
            {{ item.name }}
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div class="nav-dropdown-menu mobile-dropdown-menu">
            {% for sublink in item.sublinks %}
            <a href="{{ sublink.url | relative_url }}">{{ sublink.name }}</a>
            {% endfor %}
          </div>
        </div>
        {% else %}
        <a href="{{ item.url | relative_url }}">{{ item.name }}</a>
        {% endif %} {% endfor %}
      </nav>
    </header>

    <!-- Main Content Area -->
    {{ content }}

    <!-- Footer -->
    <footer class="site-footer">
      <div class="wrapper">
        <div class="footer-grid">
          <!-- About Section -->
          <div class="footer-col">
            <h5>{{ site.data.footer.about.title }}</h5>
            <p>{{ site.data.footer.about.description }}</p>
          </div>

          <!-- Useful Links Section -->
          <div class="footer-col">
            <h5>{{ site.data.footer.useful_links.title }}</h5>
            <ul>
              {% for link in site.data.footer.useful_links.links %}
              <li>
                <a href="{{ link.url | relative_url }}">{{ link.name }}</a>
              </li>
              {% endfor %}
            </ul>
          </div>

          <!-- Quick Links Section -->
          <div class="footer-col">
            <h5>{{ site.data.footer.quick_links.title }}</h5>
            <ul>
              {% for link in site.data.footer.quick_links.links %}
              <li>
                <a href="{{ link.url | relative_url }}">{{ link.name }}</a>
              </li>
              {% endfor %}
            </ul>
          </div>

          <!-- Follow Us Section -->
          <div class="footer-col">
            <h5>{{ site.data.footer.follow_us.title }}</h5>
            <div class="social-links">
              {% for social in site.data.footer.follow_us.socials %}
              <a
                href="{{ social.url }}"
                class="social-icon"
                title="{{ social.name }}"
              >
                {% if social.icon == 'icon-github' %}
                <span style="font-size: 14px">ğŸ±</span>
                {% elsif social.icon == 'icon-email' %}
                <span style="font-size: 14px">ğŸ“§</span>
                {% elsif social.icon == 'icon-wechat' %}
                <span style="font-size: 14px">ğŸ’¬</span>
                {% elsif social.icon == 'icon-feishu' %}
                <span style="font-size: 14px">ğŸ“º</span>
                {% else %}
                <span style="font-size: 14px">ğŸ”—</span>
                {% endif %}
              </a>
              {% endfor %}
            </div>
            <p style="margin-top: 15px; font-size: 0.8rem">
              {{ site.data.footer.follow_us.description }}
            </p>
          </div>
        </div>
        <div class="copyright">
          {{ site.data.footer.copyright.text }} | {{
          site.data.footer.copyright.icp }}
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.24.0/dist/algoliasearch.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.80.0/instantsearch.production.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // 0. ç§»åŠ¨ç«¯èœå•æ§åˆ¶
        const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
        const mobileNav = document.querySelector('.site-nav.mobile-nav');
        const mobileDropdowns = document.querySelectorAll('.mobile-dropdown');
        
        if (mobileMenuToggle && mobileNav) {
          mobileMenuToggle.addEventListener('click', function() {
            mobileMenuToggle.classList.toggle('active');
            mobileNav.classList.toggle('active');
            document.body.style.overflow = mobileNav.classList.contains('active') ? 'hidden' : '';
          });
          
          // ç‚¹å‡»èœå•å¤–åŒºåŸŸå…³é—­èœå•
          document.addEventListener('click', function(e) {
            if (mobileNav.classList.contains('active') && 
                !mobileNav.contains(e.target) && 
                !mobileMenuToggle.contains(e.target)) {
              mobileMenuToggle.classList.remove('active');
              mobileNav.classList.remove('active');
              document.body.style.overflow = '';
            }
          });
        }
        
        // ç§»åŠ¨ç«¯ä¸‹æ‹‰èœå•æ§åˆ¶
        mobileDropdowns.forEach(dropdown => {
          const toggle = dropdown.querySelector('.mobile-dropdown-toggle');
          if (toggle) {
            toggle.addEventListener('click', function() {
              dropdown.classList.toggle('active');
            });
          }
        });
        
        // 1. æµ®çª—æ§åˆ¶é€»è¾‘
        const searchOverlay = document.getElementById('search-overlay');
        const openSearchBtn = document.querySelector('.search-btn');
        const closeSearchBtn = document.querySelector('.close-search-btn');
        const overlayBg = document.querySelector('.search-overlay-bg');
        const hitsContainer = document.getElementById('global-hits-container');

        function openSearch() {
          // å…³é—­ç§»åŠ¨ç«¯èœå•ï¼ˆå¦‚æœæ‰“å¼€ï¼‰
          if (mobileNav && mobileNav.classList.contains('active')) {
            mobileMenuToggle.classList.remove('active');
            mobileNav.classList.remove('active');
            document.body.style.overflow = '';
          }
          
          searchOverlay.classList.add('active'); // ä½¿ç”¨ active ç±»æ§åˆ¶åŠ¨ç”»
          // å»¶æ—¶èšç„¦è¾“å…¥æ¡†
          setTimeout(() => {
            const input = document.querySelector('.ais-SearchBox-input');
            if (input) input.focus();
          }, 100);
        }

        function closeSearch() {
          searchOverlay.classList.remove('active');
        }

        if (openSearchBtn) {
          openSearchBtn.addEventListener('click', function(e) {
            e.preventDefault();
            openSearch();
          });
        }

        if (closeSearchBtn) {
          closeSearchBtn.addEventListener('click', closeSearch);
        }

        if (overlayBg) {
          overlayBg.addEventListener('click', closeSearch);
        }

        // ESC é”®å…³é—­
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && searchOverlay.classList.contains('active')) {
            closeSearch();
          }
        });

        // Command+K (Mac) æˆ– Ctrl+K (Windows/Linux) æ‰“å¼€æœç´¢
        document.addEventListener('keydown', function(e) {
          // æ£€æŸ¥æ˜¯å¦æŒ‰ä¸‹äº† Command+K (Mac) æˆ– Ctrl+K (Windows/Linux)
          // åŒæ—¶ç¡®ä¿ä¸åœ¨è¾“å…¥æ¡†ä¸­ï¼ˆé¿å…ä¸è¾“å…¥æ¡†å¿«æ·é”®å†²çªï¼‰
          const isInputFocused = document.activeElement.tagName === 'INPUT' || 
                                 document.activeElement.tagName === 'TEXTAREA' ||
                                 document.activeElement.isContentEditable;
          
          // å¦‚æœæœç´¢å¼¹çª—å·²æ‰“å¼€ï¼Œä¸”ç„¦ç‚¹åœ¨æœç´¢è¾“å…¥æ¡†ï¼Œåˆ™ä¸å¤„ç†ï¼ˆè®©ç”¨æˆ·æ­£å¸¸è¾“å…¥ï¼‰
          if (searchOverlay.classList.contains('active') && isInputFocused) {
            return;
          }
          
          if ((e.metaKey || e.ctrlKey) && (e.key === 'k' || e.key === 'K')) {
            e.preventDefault(); // é˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º
            if (searchOverlay.classList.contains('active')) {
              closeSearch();
            } else {
              openSearch();
            }
          }
        });

        // 2. Algolia InstantSearch åˆå§‹åŒ–
        const searchClient = algoliasearch(
          "FBCOWM9UO9",
          "fe585fa7c5e384b3bc76abe3aa6c74e7"
        );

        const search = instantsearch({
          indexName: "ander1716_github_io_fbcowm9uo9_pages",
          searchClient,
          searchFunction(helper) {
            const query = helper.state.query;
            if (query && query.length >= 1) {
              hitsContainer.style.display = 'block';
              helper.search();
            } else {
              hitsContainer.style.display = 'none';
            }
          },
        });

        search.addWidgets([
          instantsearch.widgets.searchBox({
            container: "#global-search-box",
            placeholder: "æœç´¢æ–‡ç« ã€æ•™ç¨‹...",
            showReset: true,
            showSubmit: true,
            searchAsYouType: true,
          }),
          instantsearch.widgets.hits({
            container: "#global-hits-container",
            templates: {
              item(hit, { html, components }) {
                return html`
                  <a href="${hit.url}" class="global-search-item">
                    <span class="hit-title">
                      ${components.Highlight({ hit, attribute: 'title' })}
                    </span>
                  </a>
                `;
              },
              empty(results, { html }) {
                return html`<div class="no-results">æ²¡æœ‰æ‰¾åˆ°ä¸ "${results.query}" ç›¸å…³çš„å†…å®¹</div>`;
              },
            },
          }),
        ]);

        search.start();
      });
    </script>
  </body>
</html>
